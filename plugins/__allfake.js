let fs = require('fs')
let fetch = require('node-fetch')
const moment = require('moment-timezone')

let flaaa = JSON.parse(fs.readFileSync('./api/fla.json'))
let waifu = JSON.parse(fs.readFileSync('./api/waifu.json'))
let data = JSON.parse(fs.readFileSync('./data.json'))

let handler = m => m
handler.all = async function (m) {
	let pp = 'https://telegra.ph/file/2d06f0936842064f6b3bb.png'
	try {
		pp = await this.profilePictureUrl(m.sender, 'image')
	} catch (e) {
	} finally {
		
		global.namabot = await this.user.name
		
		// Sticker WM
        global.packname = data.namabot;
        global.author = data.owner;
        
        global.wm = namabot + ' Ğ²Ñƒ Æ’ÏƒĞºÏ…Ñ• Î¹âˆ‚'
        global.colong1 = 'Ciss ğŸ“¸'
        global.colong2 = 'Ê™y á´€É¢á´œá´¢ êœ°á´€á´ÉªÊŸÉªá´€'
        global.bg = await (await fetch(img)).buffer()
		global.doc = pickRandom(["application/vnd.ms-excel", "application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/msword", "application/pdf"])
		
		// Module 
		global.fetch = require('node-fetch')
		
		const _uptime = process.uptime() * 1000
        global.u = await conn.clockString(_uptime)
		
		global.img = pickRandom(waifu)
		global.fla = pickRandom(flaaa)
		
		// Ini untuk command crator/owner
		global.kontak2 = [
         [owner[0], await this.getName(owner[0] + '@s.whatsapp.net'), 'á´…á´‡á´ á´‡ÊŸá´á´©á´‡Ê€ Ê™á´á´›', 'mr.familia13@gmail.com', true],
         [owner[1], await this.getName(owner[1] + '@s.whatsapp.net'), 'á´…á´‡á´ á´‡ÊŸá´á´©á´‡Ê€ Ê™á´á´›', 'FokusDotId13@gmail.com', true], // Kalo mau di tambah tinggal copy 1baris ini di tempel di bawahnya trs di edit dikit!
        ]
        
		// ucapan ini mah
		global.ucapan = ucapan()
		
		// pesan sementara
		global.ephemeral = '86400' // 86400 = 24jam, kalo ingin di hilangkan ganti '86400' jadi 'null' atau ''
		
		// externalAdReply atau text with thumbnail. gatau bahasa Inggris? coba translate!
		global.adReply = {
			contextInfo: {
				forwardingScore: 9999,
				isForwarded: true, // ini biar ada tulisannya diteruskan berkali-kali, jika ingin di hilangkan ganti true menjadi false
				externalAdReply: { // Bagian ini sesuka kalian berkreasi :'v
					title: "aktif selama: " + global.u,
					body: wm,
					previewType: "PHOTO",
					thumbnail: await (await fetch(img)).buffer(),
					//sourceUrl: 'https://wa.me',
				}
			}
		}
		
		// Fake ğŸ¤¥
		global.ftroli = { key: { remoteJid: 'status@broadcast', participant: '0@s.whatsapp.net' }, message: { orderMessage: { itemCount: 9999999999999999999999999999999999999999999999999999999, status: 1, surface: 1, message: wm, orderTitle: wm, sellerJid: '0@s.whatsapp.net' } } }
		global.fkontak = { key: {participant: `0@s.whatsapp.net`, ...(m.chat ? { remoteJid: `status@broadcast` } : {}) }, message: { 'contactMessage': { 'displayName': wm, 'vcard': `BEGIN:VCARD\nVERSION:3.0\nN:XL;${wm},;;;\nFN:${wm},\nitem1.TEL;waid=${m.sender.split('@')[0]}:${m.sender.split('@')[0]}\nitem1.X-ABLabell:Ponsel\nEND:VCARD`, 'jpegThumbnail': require('fs').readFileSync('./src/logo.jpg'), thumbnail: require('fs').readFileSync('./src/logo.jpg'),sendEphemeral: true}}}
		
	}
}

module.exports = handler

function ucapan() {
    const time = moment.tz('Asia/Jakarta').format('HH')
    let res = "Selamat malam ğŸŒ™"
    if (time >= 4) {
        res = "Selamat pagi ğŸŒ„"
    }
    if (time > 10) {
        res = "Selamat siang â˜€ï¸"
    }
    if (time >= 15) {
        res = "Selamat sore ğŸŒ…"
    }
    if (time >= 18) {
        res = "Selamat malam ğŸŒ™"
    }
    return res
}

function pickRandom(list) {
  return list[Math.floor(list.length * Math.random())]
}